# Copyright 2024 ETH Zurich and University of Bologna
# Solderpad Hardware License, Version 0.51, see LICENSE for details.
# SPDX-License-Identifier: SHL-0.51

package:
  name: croc_soc
  authors:
    - "Philippe Sauter <phsauter@iis.ee.ethz.ch>"

dependencies:
  # IMPORTANT: see vendor_package at the bottom
  common_cells:         { git: "https://github.com/pulp-platform/common_cells.git",         version: 1.39.0 }
  common_verification:  { git: "https://github.com/pulp-platform/common_verification.git",  rev: 5fd30c1    } # 0.2.5+
  riscv-dbg:            { git: "https://github.com/pulp-platform/riscv-dbg.git",            rev: "verilator-phsauter" }
  tech_cells_generic:   { git: "https://github.com/pulp-platform/tech_cells_generic.git",   rev: fca524a    } # 0.2.13+
  apb:                  { git: "https://github.com/pulp-platform/apb.git",                  version: 0.2.4  }
  obi:                  { git: "https://github.com/pulp-platform/obi.git",                  rev: 6a724da    } # 0.1.7+
  obi_peripherals:      { git: "https://github.com/pulp-platform/obi_peripherals.git",      rev: 21ee04d    } # UART
  cve2:                 { path: "rtl/cve2" } # a vendor package (no Bender.yml), see below 


sources:
  # Level 0
  - target: ihp13
    files:
      - ihp13/tc_clk.sv
      - ihp13/tc_sram_impl.sv

  - rtl/croc_pkg.sv
  - rtl/user_pkg.sv
  - rtl/soc_ctrl/soc_ctrl_regs_pkg.sv
  - rtl/gpio/gpio_reg_pkg.sv
  - rtl/clint/clint_reg_pkg.sv
  - rtl/obi_timer/obi_timer_reg_pkg.sv
  # add your design files containing anything but modules (packages) here

    # RTL
  - target: not(netlist_yosys)
    files:
      # Level 1
      - rtl/core_wrap.sv
      - rtl/bootrom/bootrom.sv
      - rtl/soc_ctrl/soc_ctrl_regs.sv
      - rtl/gpio/gpio_reg_top.sv
      - rtl/gpio/gpio.sv
      - rtl/clint/clint.sv
      - rtl/obi_timer/obi_timer.sv
      # Level 2
      - rtl/croc_domain.sv
      - rtl/user_domain.sv
      # add your design files with modules here
      # Level 3
      - rtl/croc_soc.sv

  - target: not(fpga)
    files:
      # Level 0
      - rtl/croc_chip.sv
  
  # netlist for simulation
  - target: netlist_yosys
    files:
      - yosys/out/netlist_debug.v

  - target: any(simulation, verilator)
    files:
      - rtl/test/tb_croc_pkg.sv
      - rtl/test/croc_vip.sv
      - rtl/test/tb_croc_soc.sv

  - target: genesys2
    files:
      - xilinx/hw/croc_xilinx.sv
      - xilinx/hw/fan_ctrl.sv

  - target: gatemate
    files:
      - nextpnr/gatemate_dev/src/croc_gm.sv

  - target: ecp5
    files:
      - nextpnr/orangecrab/src/croc_ecp5.sv

vendor_package:
  #################################
  # commonly used building blocks #
  #################################
  - name: common_cells
    target_dir: rtl/common_cells
    upstream: { git: "https://github.com/pulp-platform/common_cells.git", rev: "9ca8a7655f741e7dd5736669a20a301325194c28" } # v1.39.0
    patch_dir: "rtl/.patches/common_cells"
    exclude_from_upstream:
      - "src/deprecated"
    mapping:
      - { from: 'src/',                      to: '',                      patch_dir: 'src/' }
      - { from: 'include/common_cells/',     to: 'include/common_cells/', patch_dir: 'include/' }
      - { from: 'README.md',                 to: 'README.md',             patch_dir: '' }
      - { from: 'Bender.yml',                to: 'Bender.yml',            patch_dir: '' }

  - name: common_verification
    target_dir: rtl/common_verification
    upstream: { git: "https://github.com/pulp-platform/common_verification.git", rev: "5fd30c18a6be6f664d1ef9e44d04956fb4e3364e" } # newest (0.2.5+)
    patch_dir: "rtl/.patches/common_verification"
    mapping:
      - { from: 'src/clk_rst_gen.sv', to: 'clk_rst_gen.sv', patch_dir: 'src/' }
      - { from: 'Bender.yml',         to: 'Bender.yml',     patch_dir: '' }

  - name: tech_cells_generic
    target_dir: rtl/tech_cells_generic
    upstream: { git: "https://github.com/pulp-platform/tech_cells_generic.git", rev: "fca524a1174f6363ba0e778f37b9f398257d4b8f" } # newest (v0.2.13+)
    patch_dir: "rtl/.patches/tech_cells_generic"
    mapping:
      - { from: 'src/rtl/',   to: '',           patch_dir: 'rtl/' }
      - { from: 'src/fpga/',  to: 'fpga/',      patch_dir: 'fpga/' }
      - { from: 'Bender.yml', to: 'Bender.yml', patch_dir: '' }
      - { from: 'README.md',  to: 'README.md',  patch_dir: '' }


  #############################
  # interconnects / protocols #
  #############################
  - name: obi
    target_dir: rtl/obi
    upstream: { git: "https://github.com/pulp-platform/obi.git", rev: "6a724da5c8d6412b88b6948746e04c1adf39d017" } # newest (0.1.7+)
    patch_dir: "rtl/.patches/obi"
    exclude_from_upstream:
      - "src/test"
    mapping:
      - { from: 'src/',        to: '',            patch_dir: 'src/' }
      - { from: 'include/obi', to: 'include/obi', patch_dir: 'include/' }
      - { from: 'Bender.yml',  to: 'Bender.yml',  patch_dir: '' }
      - { from: 'Readme.md',   to: 'Readme.md',   patch_dir: '' }

  - name: apb
    target_dir: rtl/apb
    upstream: { git: "https://github.com/pulp-platform/apb.git", rev: "77ddf073f194d44b9119949d2421be59789e69ae" } # v0.2.4
    patch_dir: "rtl/.patches/apb"
    mapping:
      - { from: 'src/apb_pkg.sv', to: 'apb_pkg.sv',   patch_dir: 'src/' }
      - { from: 'include/apb/',   to: 'include/apb/', patch_dir: 'include/' }
      - { from: 'Bender.yml',     to: 'Bender.yml',   patch_dir: '' }
      - { from: 'README.md',      to: 'README.md',    patch_dir: '' }


  ###############
  # peripherals #
  ###############
  - name: riscv-dbg
    target_dir: rtl/riscv-dbg
    upstream: { git: "https://github.com/pulp-platform/riscv-dbg.git", rev: "13835b1d45f013a0760ecebd744fee6cf2e3b96a" } # branch verilator-phsauter
    patch_dir: "rtl/.patches/riscv-dbg"
    mapping:
      - { from: 'src/',                               to: '',                                   patch_dir: 'src/' }
      - { from: 'debug_rom/debug_rom.sv',             to: 'debug_rom/debug_rom.sv',             patch_dir: 'debug_rom/' }
      - { from: 'debug_rom/debug_rom_one_scratch.sv', to: 'debug_rom/debug_rom_one_scratch.sv', patch_dir: 'debug_rom/' }
      - { from: 'tb/jtag_dmi/jtag_test_simple.sv',    to: 'tb/jtag_test_simple.sv',             patch_dir: 'tb/' }
      - { from: 'Bender.yml',                         to: 'Bender.yml',                         patch_dir: '' }
      - { from: 'README.md',                          to: 'README.md',                          patch_dir: '' }


  - name: obi_peripherals
    target_dir: rtl/obi_uart
    upstream: { git: "https://github.com/pulp-platform/obi_peripherals.git", rev: "21ee04d267025f6ea3d2faa462272287ddcb9bbb"  } # newest
    patch_dir: "rtl/.patches/obi_uart"
    mapping:
      - { from: 'hw/obi_uart/', to: '',            patch_dir: 'hw/' }
      - { from: 'Bender.yml',   to: 'Bender.yml',  patch_dir: '' }


  #########
  # core  #
  #########
  # CVE2
  - name: cve2
    target_dir: rtl/cve2
    upstream: { git: "https://github.com/openhwgroup/cve2.git", rev: "53076d64c97685b1d2f5d07cd7f5cc439cf1f351" } # newest
    patch_dir: "rtl/.patches/cve2"
    mapping:
      - { from: 'rtl/',                                            to: '',                      patch_dir: 'rtl/' }
      - { from: 'README.md',                                       to: 'README.md',             patch_dir: '' }
      - { from: 'doc/03_reference/images/blockdiagram.drawio.svg', to: 'blockdiagram.svg',      patch_dir: '' }
      - { from: 'vendor/lowrisc_ip/ip/prim/rtl/',                  to: 'include/lowrisc_prim/', patch_dir: 'lowrisc_prim/' }
